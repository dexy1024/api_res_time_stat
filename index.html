<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API è€—æ—¶ç»Ÿè®¡å·¥å…·</title>
    <link rel="stylesheet" href="style.css?v=1.14.0">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“Š</text></svg>">
    
    <!-- é¢„åŠ è½½å…³é”®èµ„æº -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js" as="script">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" as="script">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-datalabels/2.2.0/chartjs-plugin-datalabels.min.js" as="script">
    <!-- Chart.js CDN - ä½¿ç”¨å…¼å®¹ç‰ˆæœ¬ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js" 
            onerror="loadBackupChart()"></script>
    <!-- Chart.js datalabels æ’ä»¶ - ä½¿ç”¨æ›´å¿«çš„ CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-datalabels/2.2.0/chartjs-plugin-datalabels.min.js" 
            onerror="loadBackupDatalabels()"></script>
    <!-- SheetJS CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- å¤‡ç”¨ Chart.js åŠ è½½å‡½æ•° -->
    <script>
        function loadBackupChart() {
            console.log('ä¸» CDN å¤±è´¥ï¼Œå°è¯•å¤‡ç”¨ CDN...');
            const script = document.createElement('script');
            script.src = 'https://unpkg.com/chart.js@3.9.1/dist/chart.min.js';
            script.onload = function() {
                console.log('å¤‡ç”¨ Chart.js åŠ è½½æˆåŠŸ');
            };
            script.onerror = function() {
                console.error('æ‰€æœ‰ Chart.js CDN éƒ½å¤±è´¥äº†');
                document.getElementById('loadingOverlay').style.display = 'none';
            };
            document.head.appendChild(script);
        }
        
        function loadBackupDatalabels() {
            console.log('datalabels æ’ä»¶åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨ç®€åŒ–ç‰ˆæœ¬...');
            // å¦‚æœæ’ä»¶åŠ è½½å¤±è´¥ï¼Œæˆ‘ä»¬å°†åœ¨ JavaScript ä¸­å¤„ç†
        }
    </script>
</head>
<body>
    <div class="container">
        <header>
            <h1>API è€—æ—¶ç»Ÿè®¡å·¥å…·</h1>
            <p>ä¸Šä¼  Excel æˆ– CSV æ–‡ä»¶ï¼Œåˆ†æ API è°ƒç”¨è€—æ—¶åˆ†å¸ƒ</p>
        </header>

        <!-- æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ -->
        <section class="upload-section">
            <div class="upload-area" id="uploadArea">
                <div class="upload-content">
                    <div class="upload-icon">ğŸ“</div>
                    <h3>ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ æ–‡ä»¶</h3>
                    <p>æ”¯æŒ <span class="file-types">.xlsx</span>ã€<span class="file-types">.xls</span> å’Œ <span class="file-types">.csv</span> æ ¼å¼</p>
                    <input type="file" id="fileInput" accept=".xlsx,.xls,.csv" style="display: none;">
                </div>
            </div>
            <div class="file-info" id="fileInfo" style="display: none;">
                <div class="file-details">
                    <span class="file-name" id="fileName"></span>
                    <span class="file-status" id="fileStatus"></span>
                </div>
                <div class="file-actions">
                    <button class="analyze-btn" id="analyzeBtn">å¼€å§‹åˆ†æ</button>
                    <button class="clear-btn" id="clearBtn">æ¸…é™¤æ–‡ä»¶</button>
                    <button class="stop-btn" id="stopBtn" style="display: none;">åœæ­¢æ¸²æŸ“</button>
                </div>
            </div>
        </section>

        <!-- æ•°æ®ç»Ÿè®¡æ‘˜è¦ -->
        <section class="summary-section" id="summarySection" style="display: none;">
            <h2>æ•°æ®ç»Ÿè®¡æ‘˜è¦</h2>
            <div class="summary-cards">
                <div class="summary-card">
                    <h3>æ€»è°ƒç”¨æ¬¡æ•°</h3>
                    <span class="summary-value" id="totalCalls">0</span>
                </div>
                <div class="summary-card">
                    <h3>å¹³å‡è€—æ—¶</h3>
                    <span class="summary-value" id="avgTime">0ms</span>
                </div>
                <div class="summary-card">
                    <h3>æœ€é•¿è€—æ—¶</h3>
                    <span class="summary-value" id="maxTime">0ms</span>
                </div>
                <div class="summary-card">
                    <h3>æœ€çŸ­è€—æ—¶</h3>
                    <span class="summary-value" id="minTime">0ms</span>
                </div>
            </div>
        </section>

        <!-- å›¾è¡¨å±•ç¤ºåŒºåŸŸ -->
        <section class="charts-section" id="chartsSection" style="display: none;">
            <h2>è€—æ—¶åˆ†å¸ƒå›¾è¡¨</h2>
            <div class="charts-container">
                <div class="chart-wrapper">
                    <h3>è€—æ—¶åˆ†å¸ƒé¥¼å›¾</h3>
                    <canvas id="pieChart"></canvas>
                </div>
            </div>
        </section>

        <!-- è€—æ—¶åˆ†å¸ƒç»Ÿè®¡è¡¨ -->
        <section class="table-section" id="distributionTableSection" style="display: none;">
            <h2>è€—æ—¶åˆ†å¸ƒç»Ÿè®¡è¡¨</h2>
            <div class="table-container">
                <table id="distributionTable">
                    <thead>
                        <tr>
                            <th>è€—æ—¶åŒºé—´</th>
                            <th>æ•°é‡</th>
                            <th>å æ¯”</th>
                            <th>é¢œè‰²</th>
                        </tr>
                    </thead>
                    <tbody id="distributionTableBody">
                    </tbody>
                </table>
            </div>
        </section>

        <!-- æ¥å£è¯¦æƒ…ç»Ÿè®¡è¡¨ -->
        <section class="table-section" id="tableSection" style="display: none;">
            <h2>æ¥å£è¯¦æƒ…ç»Ÿè®¡</h2>
            <div class="table-container">
                <table id="dataTable">
                    <thead>
                        <tr>
                            <th onclick="sortTable(0)">æ¥å£åç§° <span class="sort-icon">â†•</span></th>
                            <th onclick="sortTable(1)">æ¥å£ä¸­æ–‡å <span class="sort-icon">â†•</span></th>
                            <th onclick="sortTable(2)">æ•°é‡ <span class="sort-icon">â†•</span></th>
                            <th onclick="sortTable(3)">å¹³å‡è€—æ—¶(ms) <span class="sort-icon">â†•</span></th>
                            <th onclick="sortTable(4)">æœ€é•¿è€—æ—¶(ms) <span class="sort-icon">â†•</span></th>
                            <th onclick="sortTable(5)">æœ€çŸ­è€—æ—¶(ms) <span class="sort-icon">â†•</span></th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                    </tbody>
                </table>
            </div>
        </section>

        <!-- 5000msä»¥ä¸Šæ¥å£ç»Ÿè®¡è¡¨ï¼ˆç½®äºé¡µé¢åº•éƒ¨ï¼‰ -->
        <section class="table-section" id="slowTableSection" style="display: none;">
            <h2>5000msä»¥ä¸Šæ¥å£ç»Ÿè®¡</h2>
            <div class="table-container">
                <table id="slowTable">
                    <thead>
                        <tr>
                            <th>æ¥å£åç§°</th>
                            <th>æ¥å£ä¸­æ–‡å</th>
                            <th>æ•°é‡</th>
                        </tr>
                    </thead>
                    <tbody id="slowTableBody">
                    </tbody>
                </table>
            </div>
        </section>

        <!-- åŠ è½½çŠ¶æ€ -->
        <div class="loading-overlay" id="loadingOverlay" style="display: none;">
            <div class="loading-content">
                <div class="loading-spinner"></div>
                <p>æ­£åœ¨åŠ è½½èµ„æº...</p>
            </div>
        </div>

        <!-- é”™è¯¯æç¤º -->
        <div class="error-message" id="errorMessage" style="display: none;">
            <span id="errorText"></span>
            <button onclick="hideError()">Ã—</button>
        </div>
    </div>

    <script src="app.js?v=1.14.0"></script>
</body>
</html>
